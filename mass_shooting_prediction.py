# -*- coding: utf-8 -*-
"""Mass Shooting Prediction

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ZvG9hGZkdr7Gl6858V1e0Hqr79wctesS
"""

import pandas as pd
from prophet import Prophet
import matplotlib.pyplot as plt
import os

def main():
    data_path = 'data/Mass-Shootings-Dataset-Ver-5.csv'

    if not os.path.exists(data_path):
        print(f"Error: Dataset not found at '{data_path}'.")
        print("Please download from: https://www.kaggle.com/datasets/zusmani/us-mass-shootings-last-50-years")
        return

    df = pd.read_csv(data_path, encoding='latin1')
    df['Date'] = pd.to_datetime(df['Date'], format='%m/%d/%Y')

    df_prophet = df.groupby('Date').size().reset_index(name='incidents')
    df_prophet.columns = ['ds', 'y']

    print("Dataset prepared for Prophet. Head:")
    print(df_prophet.head())

    model = Prophet(yearly_seasonality=True, weekly_seasonality=True, daily_seasonality=False)

    print("\nFitting the Prophet model...")
    model.fit(df_prophet)
    print("Model fitting complete.")

    future = model.make_future_dataframe(periods=365)

    print("\nMaking future predictions...")
    forecast = model.predict(future)
    print("Prediction complete.")

    print("\nPlotting the forecast...")
    fig1 = model.plot(forecast)
    plt.title('Forecast of Mass Shooting Incidents in the US')
    plt.xlabel('Date')
    plt.ylabel('Incidents')
    plt.savefig('forecast_plot.png')
    print("Forecast plot saved as forecast_plot.png")

    fig2 = model.plot_components(forecast)
    plt.savefig('forecast_components.png')
    print("Forecast components plot saved as forecast_components.png")

    print("\nAnalysis complete.")

if __name__ == '__main__':
    main()